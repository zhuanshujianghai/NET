<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>OA-项目管理</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <link rel="shortcut icon" href="/Content/style/img/logo.ico" />
    <link href="/Content/hl/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="/Content/hl/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
    <link href="/Content/hl/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="/Content/hl/css/style-metro.css" rel="stylesheet" type="text/css" />
    <link href="/Content/hl/css/style.css" rel="stylesheet" type="text/css" />
    <link href="/Content/hl/css/style-responsive.css" rel="stylesheet" type="text/css" />
    <link href="/Content/hl/css/default.css" rel="stylesheet" type="text/css" id="style_color" />
    <link href="/Content/hl/css/select2_metro.css" rel="stylesheet" type="text/css" />
    <link href="/Content/hl/css/DT_bootstrap.css" rel="stylesheet" type="text/css" />
    <link href="/Content/datatables/css/jquery.dataTables.min.css" rel="stylesheet" type="text/css" />
    <link href="/Content/hl/css/bootstrap-modal.css" rel="stylesheet" type="text/css">
</head>
<body class="page-header-fixed">
    <div class="header navbar navbar-inverse navbar-fixed-top">
        $topdiv$
    </div>
    <div class="page-container row-fluid">
        <div class="page-sidebar nav-collapse collapse">
            <ul class="page-sidebar-menu">
                $leftdiv$
            </ul>
        </div>
        <div class="page-content">
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span12">
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span12">
                        <div class="portlet box blue">
                            <div class="portlet-title">
                                <div class="caption">
                                    <i class="icon-edit"></i>BUG列表
                                </div>
                                <div class="tools">
                                    <a href="javascript:;" class="collapse"></a><a href="javascript:;" class="reload" onclick="reload()"></a><a href="javascript:;" class="remove"></a>
                                </div>
                            </div>
                            <div class="portlet-body" style="overflow-x: auto;">
                                <div class='clearfix' style='padding-bottom: 15px;' id='tiaojian'>
                                    <a class='btn blue' id='modal_ajax_demo_btn1' href='' rel='/admin_project/editprojectbug?pid=$pid$' data-toggle='modal'>提BUG</a>
                                </div>
                                <table class="table table-striped table-bordered table-hover dataTable" id="sample_editable_1">
                                    <thead id="thead">
                                    </thead>
                                    <tbody id="tbody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="ajax-modal" class="modal hide fade in" tabindex="-1">
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="/Content/hl/js/jquery-1.11.3.js"></script>
    <script type="text/javascript" src="/Content/hl/js/jquery-migrate-1.2.1.min.js" ></script>
    <script type="text/javascript" src="/Content/hl/js/jquery-ui-1.10.1.custom.min.js" ></script>
    <script type="text/javascript" src="/Content/hl/js/bootstrap.min.js" ></script>
    <script type="text/javascript" src="/Content/hl/js/jquery.slimscroll.min.js" ></script>
    <script type="text/javascript" src="/Content/hl/js/jquery.blockui.min.js" ></script>
    <script type="text/javascript" src="/Content/hl/js/jquery.cookie.min.js" ></script>
    <script type="text/javascript" src="/Content/hl/js/jquery.dataTables.js" ></script>
    <script type="text/javascript" src="/Content/hl/js/DT_bootstrap.js" ></script>
    <script type="text/javascript" src="/Content/hl/js/bootstrap-modal.js" ></script>
    <script type="text/javascript" src="/Content/hl/js/bootstrap-modalmanager.js" ></script>
    <script type="text/javascript" src="/Content/hl/js/app.js" ></script>
    <script type="text/javascript" src="/Content/hl/js/table-editable.js" ></script>
    <script type="text/javascript" src="/Content/hl/js/ui-modals.js" ></script>
    <script type="text/javascript" src="/Content/datatables/js/jquery.dataTables.min.js"></script>

    <script type="text/javascript" src="/Content/hl/js/jquery.uniform.min.js"></script>
    <script type="text/javascript" src="/Content/hl/js/ckeditor.js"></script>
    <script type="text/javascript" src="/Content/hl/js/bootstrap-fileupload.js"></script>
    <script type="text/javascript" src="/Content/hl/js/chosen.jquery.min.js"></script>
    <script type="text/javascript" src="/Content/hl/js/select2.min.js"></script>
    <script type="text/javascript" src="/Content/hl/js/wysihtml5-0.3.0.js"></script>
    <script type="text/javascript" src="/Content/hl/js/bootstrap-wysihtml5.js"></script>
    <script type="text/javascript" src="/Content/hl/js/jquery.tagsinput.min.js"></script>
    <script type="text/javascript" src="/Content/hl/js/jquery.toggle.buttons.js"></script>
    <script type="text/javascript" src="/Content/hl/js/bootstrap-datepicker.js"></script>
    <script type="text/javascript" src="/Content/hl/js/bootstrap-datetimepicker.js"></script>
    <script type="text/javascript" src="/Content/hl/js/clockface.js"></script>
    <script type="text/javascript" src="/Content/hl/js/date.js"></script>
    <script type="text/javascript" src="/Content/hl/js/daterangepicker.js"></script>
    <script type="text/javascript" src="/Content/hl/js/bootstrap-colorpicker.js"></script>
    <script type="text/javascript" src="/Content/hl/js/bootstrap-timepicker.js"></script>
    <script type="text/javascript" src="/Content/hl/js/jquery.inputmask.bundle.min.js"></script>
    <script type="text/javascript" src="/Content/hl/js/jquery.input-ip-address-control-1.0.min.js"></script>
    <script type="text/javascript" src="/Content/hl/js/jquery.multi-select.js"></script>
    <script type="text/javascript" src="/Content/hl/js/form-components.js"></script>
    <script type="text/javascript">
        var tbl;
        jQuery(document).ready(function () {
            $("#thead").html("<tr><th>ID</th><th>级别</th><th>Bug标题</th><th>类型</th><th>状态</th><th>提出人</th><th>解决人</th><th>操作</th></tr>");
            load();
        });
        function load() {
            tbl = $('#sample_editable_1').dataTable({
                "bServerSide": true, //是否服务器端处理
                "bSort": false, //是否排序
                "sAjaxSource": "/Admin_ProjectNoView/QueryProjectBugList", //mvc后台ajax调用接口。
                'bPaginate': true, //是否分页。
                //添加提交参数
                "fnServerParams": function (aoData) {
                    aoData.push({
                        "name": "pid",
                        "value": $pid$
                    });
                },
                "oLanguage": {
                    "sLengthMenu": "每页显示 _MENU_ 条记录",
                    "sZeroRecords": "抱歉， 没有找到",
                    "sInfo": "从 _START_ 到 _END_ /共 _TOTAL_ 条数据",
                    "sInfoEmpty": "没有数据",
                    "sSearch": "搜索:",
                    "sInfoFiltered": "(从 _MAX_ 条数据中检索)",
                    "oPaginate": {
                        //"sFirst": "首页",
                        "sPrevious": "上一页",
                        "sNext": "下一页"
                        //"sLast": "尾页"
                    },
                    "sZeroRecords": "没有检索到数据"
                },
                "bProcessing": true, //当datatable获取数据时候是否显示正在处理提示信息。
                'bFilter': true, //是否使用内置的过滤功能。
                'searching': true, //是否有搜索
                "deferRender": true, //延迟渲染，数据大时有效果
                "bLengthChange": true, //是否允许用户自定义每页显示条数。
                "sPaginationType": 'simple_numbers', //分页样式{simple,simple_number,full,full_numbers}
                //指定列的字段
                "aoColumns": [
                    { "data": "id" },
                    { "data": "degree" },
                    { "data": "title" },
                    { "data": "type" },
                    { "data": "status" },
                    { "data": "writerusername" },
                    { "data": "editorusername" },
                    { "data": "id" }
                ],
                //对指定列的字段进行重写
                "columnDefs": [
                    {
                        "render": function (data, type, row) {
                            if (data == 0) { return "普通"; } else if (data == 1) { return "重要"; } else if (data == 2) { return "紧急"; } else { return "普通"; }
                        },
                        "targets": 1
                    }, {
                        "render": function (data, type, row) {
                            return "<a href='/admin_project/queryprojectbug?id="+row.id+"'>" + data + "</a>";
                        },
                        "targets": 2
                    }, {
                        "render": function (data, type, row) {
                            var type;
                            switch (data)
                            {
                                case 0:
                                    type = "代码错误";
                                    break;
                                case 1:
                                    type = "界面优化";
                                    break;
                                case 2:
                                    type = "设计缺陷";
                                    break;
                                case 3:
                                    type = "配置相关";
                                    break;
                                case 4:
                                    type = "安装部署";
                                    break;
                                case 5:
                                    type = "安全相关";
                                    break;
                                case 6:
                                    type = "性能问题";
                                    break;
                                case 7:
                                    type = "标准规范";
                                    break;
                                case 8:
                                    type = "测试脚本";
                                    break;
                                case 9:
                                    type = "其他";
                                    break;
                                default:
                                    type = "类型异常";
                                    break;
                            }
                            return type;
                        },
                        "targets": 3
                    }, {
                        "render": function (data, type, row) {
                            var status;
                            switch(data)
                            {
                                case 0:
                                    status = "未确认";
                                    break;
                                case 1:
                                    status = "未解决";
                                    break;
                                case 2:
                                    status = "待关闭";
                                    break;
                                case 3:
                                    status = "已完成";
                                    break;
                                default:
                                    status = "状态异常";
                                    break;
                            }
                            return status;
                        },
                        "targets": 4
                    }, {
                        "render": function (data, type, row) {
                            var confirm = "<a class='btn mini' style='cursor: not-allowed' href='javascript:;'>确认</a>"; 
                            var resolve = "<a class='btn mini' style='cursor: not-allowed' href='javascript:;'>解决</a>";
                            var close = "<a class='btn mini' style='cursor: not-allowed' href='javascript:;'>关闭</a>";
                            switch (row.status) {
                                case 0:
                                    confirm = "<a class='btn mini blue' href='javascript:updatestatus(" + row.id + ",\"confirm\")'>确认</a>";
                                    break;
                                case 1:
                                    resolve = "<a class='btn mini blue' href='javascript:updatestatus(" + row.id + ",\"resolve\")'>解决</a>";
                                    break;
                                case 2:
                                    close = "<a class='btn mini green' href='javascript:updatestatus(" + row.id + ",\"close\")'>关闭</a>";
                                    break;
                                case 3:
                                    break;
                                default:
                                    break;
                            }
                            return confirm+" <a href='javascript:;' class='btn mini green' rel='/admin_project/editprojectbugeditor?id=" + row.id + "'>指派</a> "+resolve+" "+close+" <a href='javascript:;' class='btn mini green' rel='/admin_project/editprojectbug?id=" + row.id + "'>编辑</a>";
                        },
                        "targets": 7
                    }],
                //datatables初始化完毕后的回调函数
                "fnInitComplete": function (oSettings, json) {
                    addsearch();
                },
                //datatables重绘完毕后的回调函数,初始化也调用了该回调函数
                "fnDrawCallback": function (oSettings) {
                    UIModals.init();
                }
            });
            App.init();
        }
        function reload() {
            tbl.fnDraw();
        }
        //添加搜索标签
        function addsearch() {
            var html = "<div class='dataTables_filter'><lable><input id='title' class='m-wrap' type='text' placeholder='But标题' /><input type='button' class='btn blue' value='搜索' onclick='reload()'></lable></div>";
            $("#sample_editable_1_filter").html(html);
        }
        function updatestatus(bid,type)
        {
            $.post("/admin_projectnoview/updateprojectbugstatus", { bid:bid,type:type }, function (data) {
                if (data.status == true) {
                    reload();
                }
                else {
                    alert(data.msg);
                }
            });
        }
    </script>
</body>
</html>
